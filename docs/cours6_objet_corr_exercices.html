
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Objets &#8212; Le langage Python</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/agogo.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Utilisation de numpy" href="cours5_numpy_corr_exercices.html" />
    <link rel="prev" title="Chaînes de caractères" href="cours4_chaine_caractere_corr_exercices.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">Le langage Python</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="cours4_chaine_caractere_corr_exercices.html" title="Chaînes de caractères"
             accesskey="P">previous</a> |
          <a href="cours5_numpy_corr_exercices.html" title="Utilisation de numpy"
             accesskey="N">next</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="objets">
<h1>Objets<a class="headerlink" href="#objets" title="Permalink to this headline">¶</a></h1>
<section id="vecteur">
<h2>Vecteur<a class="headerlink" href="#vecteur" title="Permalink to this headline">¶</a></h2>
<p>Créer une classe Vecteur3D. Chaque vecteur aura 3 attributs : x, y, z</p>
<ul class="simple">
<li><p>Écrire une méthode norme qui renvoie la norme.</p></li>
<li><p>Écrire la méthode <code class="docutils literal notranslate"><span class="pre">__add__</span></code> pour faire la somme entre deux veteurs</p></li>
<li><p>Écrire la méthode <code class="docutils literal notranslate"><span class="pre">__mul__</span></code> pour faire soit le produit par un scalaire (<span class="math notranslate nohighlight">\(2\vec{u}\)</span>) ou le produit scalaire (<span class="math notranslate nohighlight">\(\vec{u}\cdot\vec{v}\)</span>).</p></li>
</ul>
</section>
<section id="bibliographie">
<h2>Bibliographie<a class="headerlink" href="#bibliographie" title="Permalink to this headline">¶</a></h2>
<p>Un livre est décrit par son titre, auteur et année de publication (pour faire les choses simplements). Écrire une classe <code class="docutils literal notranslate"><span class="pre">Livre</span></code> qui enregistre ces informations. Ecrire la méthode <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> et <code class="docutils literal notranslate"><span class="pre">__str__</span></code>.</p>
<p>Une bibliographe est une liste de livre. Écrire la classe <code class="docutils literal notranslate"><span class="pre">Bibliographie</span></code> qui enregistre une liste de livre (on stockera la liste de livre sous forme d’une liste qui sera un attribut de la bibliographie).</p>
<p>L’objectif final est de pouvoir faire ceci ::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>livre1 = Livre(&quot;A very nice book&quot;, &quot;F. Dupont&quot;, 2014)
livre2 = Livre(&quot;A very smart book&quot;, &quot;A. Einstein&quot;, 1923)
livre3 = Livre(&quot;A very stupid comic&quot;, &quot;D. Duck&quot;, 1937)

bibliographie = Bibliographie([book1, book2, book3])
</pre></div>
</div>
<p>Maintenant que tout est fait sous forme d’objet, on peut imaginer écrire plusieurs méthode :</p>
<ul class="simple">
<li><p>Écrire une méthode <code class="docutils literal notranslate"><span class="pre">filter_by_year</span></code> qui fait une nouvelle bibliographie ne contenant que les livres d’une année donée.</p></li>
<li><p>Écrire une méthode <code class="docutils literal notranslate"><span class="pre">to_html</span></code> qui formate correctement la bibliographie. La méthode de la classe Bibliographie devra appeler une méthode pour chaque Livre.</p></li>
</ul>
<p>Et en HTML ::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;table&gt;
    &lt;thead&gt;
        &lt;tr&gt; &lt;th&gt;Auteur&lt;/th&gt;&lt;th&gt;Titre&lt;/th&gt;&lt;th&gt;Année&lt;/th&gt;&lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
       &lt;tr&gt;&lt;td&gt;F. Dupont&lt;/td&gt;&lt;td&gt;2014&lt;/td&gt;&lt;td&gt;A very nice book&lt;/td&gt;&lt;/tr&gt;
       &lt;tr&gt;&lt;td&gt;A. Einstein&lt;/td&gt;&lt;td&gt;1923&lt;/td&gt;&lt;td&gt;A very smart book&lt;/td&gt;&lt;/tr&gt;
       &lt;tr&gt;&lt;td&gt;D. Duck&lt;/td&gt;&lt;td&gt;1937&lt;/td&gt;&lt;td&gt;A very stupid comic&lt;/td&gt;&lt;/tr&gt;
    &lt;/tbody&gt;
&lt;/table&gt;
</pre></div>
</div>
<p>Remarque : si un objet possède une méthode <code class="docutils literal notranslate"><span class="pre">_repr_html_</span></code>, alors le jupyter notebook utilsera automatiquement la représentation en HTML. Rajouter cette méthode (qui appelera to_html).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Livre</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">auteur</span><span class="p">,</span> <span class="n">annee</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">titre</span> <span class="o">=</span> <span class="n">titre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auteur</span> <span class="o">=</span> <span class="n">auteur</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annee</span> <span class="o">=</span> <span class="n">annee</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Livre(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">titre</span><span class="si">!r}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">auteur</span><span class="si">!r}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annee</span><span class="si">!r}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">to_html_table_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">auteur</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">titre</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annee</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span>
    
    
<span class="n">bibio_html_template</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&lt;table&gt;</span>
<span class="s2">&lt;thead&gt;</span>
<span class="s2">&lt;tr&gt;&lt;th&gt;Auteur&lt;/th&gt;&lt;th&gt;Titre&lt;/th&gt;&lt;th&gt;Année&lt;/th&gt;&lt;/tr&gt;</span>
<span class="s2">&lt;/thead&gt;</span>
<span class="s2">&lt;tbody&gt;</span>
<span class="si">{content}</span><span class="s2"></span>
<span class="s2">&lt;/tbody&gt;</span>
<span class="s2">&lt;/table&gt;&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">Bibliographie</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">liste_des_livres</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_liste_livres</span> <span class="o">=</span> <span class="n">liste_des_livres</span>
        
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_liste_livres</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Bibliographie(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_liste_livres</span><span class="si">!r}</span><span class="s2">)&quot;</span>
        
    <span class="k">def</span> <span class="nf">to_html_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">livre</span><span class="o">.</span><span class="n">to_html_table_line</span><span class="p">()</span> <span class="k">for</span> <span class="n">livre</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_liste_livres</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">bibio_html_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span>
        
    <span class="n">_repr_html_</span> <span class="o">=</span> <span class="n">to_html_table</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">livre1</span> <span class="o">=</span> <span class="n">Livre</span><span class="p">(</span><span class="s2">&quot;A very nice book&quot;</span><span class="p">,</span> <span class="s2">&quot;F. Dupont&quot;</span><span class="p">,</span> <span class="mi">2014</span><span class="p">)</span>
<span class="n">livre2</span> <span class="o">=</span> <span class="n">Livre</span><span class="p">(</span><span class="s2">&quot;A very smart book&quot;</span><span class="p">,</span> <span class="s2">&quot;A. Einstein&quot;</span><span class="p">,</span> <span class="mi">1923</span><span class="p">)</span>
<span class="n">livre3</span> <span class="o">=</span> <span class="n">Livre</span><span class="p">(</span><span class="s2">&quot;A very stupid comic&quot;</span><span class="p">,</span> <span class="s2">&quot;D. Duck&quot;</span><span class="p">,</span> <span class="mi">1937</span><span class="p">)</span>

<span class="n">bibliographie</span> <span class="o">=</span> <span class="n">Bibliographie</span><span class="p">([</span><span class="n">livre1</span><span class="p">,</span> <span class="n">livre2</span><span class="p">,</span> <span class="n">livre3</span><span class="p">])</span>
<span class="n">bibliographie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>Auteur</th><th>Titre</th><th>Année</th></tr>
</thead>
<tbody>
<tr><td>F. Dupont</td><td>A very nice book</td><td>2014</td></tr>
<tr><td>A. Einstein</td><td>A very smart book</td><td>1923</td></tr>
<tr><td>D. Duck</td><td>A very stupid comic</td><td>1937</td></tr>
</tbody>
</table></div></div>
</div>
</section>
<section id="systeme-de-calcul-formel">
<h2>Système de calcul formel<a class="headerlink" href="#systeme-de-calcul-formel" title="Permalink to this headline">¶</a></h2>
<p><em>Cet exercice est à but purement pédagogique. Pour utiliser un système de calcul formel sous Python, la librairie <code class="docutils literal notranslate"><span class="pre">sympy</span></code> existe et fonctionnera bien mieux que ce que l’on va faire !</em></p>
<p>L’objectif de ce TD est de réaliser un système de calcul formel qui permettra de manipuler des expressions algébriques simples et de réaliser des opérations simples. Par exemple, on souhaite pouvoir effectuer ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">y</span>

<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># Dérivée par rapport à x</span>
</pre></div>
</div>
<p>Chaque expression sera représentée par un arbre. Les feuilles de l’arbre seront soit les symboles soit les constantes numériques. Les noeuds seront des fonctions à un ou plusieurs argument (sinus, somme, opposé, …). Le nom de la classe du noeud désignera la fonction. Les “enfants” du noeud seront les arguments de la fonction. Par exemple l’expression ci dessus correspondra à l’objet suivant ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sA : 2*x*y</span>
<span class="n">sA</span> <span class="o">=</span> <span class="n">Prod</span><span class="p">(</span><span class="n">Prod</span><span class="p">(</span><span class="n">Number</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)),</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>
<span class="c1"># sB : sin(x)*y</span>
<span class="n">sB</span> <span class="o">=</span> <span class="n">Prod</span><span class="p">(</span><span class="n">Sin</span><span class="p">(</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)),</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">(</span><span class="n">sA</span><span class="p">,</span> <span class="n">sB</span><span class="p">)</span>
</pre></div>
</div>
<section id="structure-du-programme">
<h3>Structure du programme<a class="headerlink" href="#structure-du-programme" title="Permalink to this headline">¶</a></h3>
<p>Voici la structure de base ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Expr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Leave</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Pour les feuilles ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Symbol</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Ensuite on définit les fonctions ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function with an arbitrary number of arguments &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Les opérateurs sont des fonctions comme les autres, mais elle seront simplement affichées différemment ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BinaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="k">pass</span> 
<span class="c1"># Idem pour Sub, Div, Prod, Pow</span>

<span class="k">class</span> <span class="nc">UnitaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Neg</span><span class="p">(</span><span class="n">UnitaryOperateor</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Les fonction mathématiques, qui prennent un seul argument ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MathFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Sin</span><span class="p">(</span><span class="n">MathFunction</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="questions">
<h3>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h3>
<p>On va procéder étape par étape. Il sera plus facile de commencer par les feuilles avant d’écrire la structure globale.</p>
<ol class="arabic simple">
<li><p>Ecrire le <code class="docutils literal notranslate"><span class="pre">__init__</span></code> de la classe Symbol et Number</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Expr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Leave</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Symbol</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function with an arbitrary number of arguments &quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">BinaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="k">pass</span> 
<span class="c1"># Idem pour Sub, Div, Prod, Pow</span>

<span class="k">class</span> <span class="nc">UnitaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Neg</span><span class="p">(</span><span class="n">UnitaryOperator</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MathFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Sin</span><span class="p">(</span><span class="n">MathFunction</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numbers</span>

<span class="k">class</span> <span class="nc">Symbol</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbole</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symb</span> <span class="o">=</span> <span class="n">symbole</span>
        
<span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbre</span> <span class="o">=</span> <span class="n">nombre</span>
        
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Ecrire une méthode <code class="docutils literal notranslate"><span class="pre">display</span></code> sur ces classes afin de renvoyer une chaîne de caractère contenant le symbole ou le nombre</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Symbol</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbole</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symb</span> <span class="o">=</span> <span class="n">symbole</span>

    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symb</span>

<span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbre</span> <span class="o">=</span> <span class="n">nombre</span>
        
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbre</span><span class="p">)</span>
        
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p>Ecrire le <code class="docutils literal notranslate"><span class="pre">__init__</span></code> de la class Sin ainsi que le display. Le display devra appeler le display de l’argument. Par exemple ceci devra fonctionner ::</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="go">sin(x)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sin</span><span class="p">(</span><span class="n">Sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="go">sin(sin(x))</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Sin</span><span class="p">(</span><span class="n">MathFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
        
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Sin(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="o">.</span><span class="n">display</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span>
    
<span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">Sin</span><span class="p">(</span><span class="n">Sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Sin(Sin(x))&#39;
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="4">
<li><p>Généraliser le <strong>init</strong> et le display de <code class="docutils literal notranslate"><span class="pre">Sin</span></code> afin de le mettre dans la class MathFunction. On rajoutera un attribut de classe à chaque sous classe de MathFunction ::</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Sin</span><span class="p">(</span><span class="n">MathFunction</span><span class="p">):</span>
    <span class="n">funtion_name</span> <span class="o">=</span> <span class="s1">&#39;sin&#39;</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MathFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="o">.</span><span class="n">display</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span>


<span class="k">class</span> <span class="nc">Sin</span><span class="p">(</span><span class="n">MathFunction</span><span class="p">):</span>
    <span class="n">function_name</span> <span class="o">=</span> <span class="s1">&#39;sin&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
        
    
<span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">Sin</span><span class="p">(</span><span class="n">Sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;sin(sin(x))&#39;
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="5">
<li><p>Faire de même pour les opérateurs binaires. On pourra commencer par simplement le faire pour Sum, puis généraliser avec un attribut de classe ::</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function with an arbitrary number of arguments &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

<span class="k">class</span> <span class="nc">BinaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">()</span><span class="si">}</span><span class="s1">) </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_name</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span>
    
<span class="k">class</span> <span class="nc">Prod</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>

    
<span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">Sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Sin</span><span class="p">(</span><span class="n">Prod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;(x) + (sin((x) * (y)))&#39;
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="6">
<li><p>A ce stade quelque chose comme ceci devrait fonctionner ::</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">Sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Sin</span><span class="p">(</span><span class="n">Prod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
</pre></div>
</div>
<p>Rajouter les méthodes <code class="docutils literal notranslate"><span class="pre">__add__</span></code>, <code class="docutils literal notranslate"><span class="pre">__mul__</span></code>, etc à la classe Expr afin de pouvoir écrire :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">+</span> <span class="n">Sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">+</span> <span class="n">Sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(x) + (sin((x) * (y)))
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="7">
<li><p>Ecrire les méthodes <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> afin de calculer la valeur numérique d’une expression. Cette méthode fonctionnera de la sorte :</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expr</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">Sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>On aura donc le protocole suivant ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Le dictionnaire kwd sera passé récursivement jusqu’aux feuilles et sera utilisé pour évaluer les symboles.</p>
<p>Les opérateurs binaires numériques sont définis dans le module <code class="docutils literal notranslate"><span class="pre">operator</span></code> et les fonctions dans le module <code class="docutils literal notranslate"><span class="pre">math</span></code>. Afin de factoriser le code, on rajoutera donc simplement un attribut de classe du type <code class="docutils literal notranslate"><span class="pre">operator_function</span> <span class="pre">=</span> <span class="pre">operator.add</span></code> pour les opérateurs binaires et <code class="docutils literal notranslate"><span class="pre">math_function</span> <span class="pre">=</span> <span class="pre">math.sin</span></code> pour les fonctions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numbers</span> 
<span class="kn">import</span> <span class="nn">operator</span>

<span class="k">class</span> <span class="nc">Expr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Leave</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">UnitaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Neg</span><span class="p">(</span><span class="n">UnitaryOperator</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Symbol</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbole</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symb</span> <span class="o">=</span> <span class="n">symbole</span>

    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symb</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kwd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symb</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;La valeur de </span><span class="si">{}</span><span class="s2"> n&#39;est pas définie&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symb</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbre</span> <span class="o">=</span> <span class="n">nombre</span>
        
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbre</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbre</span>
            
<span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function with an arbitrary number of arguments &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="n">evaluated_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">**</span><span class="n">kwd</span><span class="p">)</span> <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">math_function</span><span class="p">(</span><span class="o">*</span><span class="n">evaluated_args</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">BinaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">()</span><span class="si">}</span><span class="s1">) </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_name</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span>
    
<span class="k">class</span> <span class="nc">Prod</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
    <span class="n">math_function</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span>
    
<span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
    <span class="n">math_function</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span>

<span class="k">class</span> <span class="nc">MathFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span>


<span class="k">class</span> <span class="nc">Sin</span><span class="p">(</span><span class="n">MathFunction</span><span class="p">):</span>
    <span class="n">function_name</span> <span class="o">=</span> <span class="s1">&#39;sin&#39;</span>
    <span class="n">math_function</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg</span><span class="p">,)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">expr</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">Sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
<span class="n">expr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">4.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(x) + (sin((x) * (y)))
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.4121184852417565
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="8">
<li><p>Maintenant que vous avez compris le principe, il devrait être facile d’écrire une méthode <code class="docutils literal notranslate"><span class="pre">diff</span></code> qui effectue la dérivée par rapport à une variable !</p></li>
<li><p>Reste à simplifier les expressions. Une technique consiste à créer des règles de simplifications sous forme de méthode que l’on regroupe ensuite dans une liste ::</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
    <span class="n">operator_function</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span>

    <span class="k">def</span> <span class="nf">simplication_de_deux_nombres</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> 
                        <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Number</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simplication_addition_avec_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="n">liste_simplication</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;simplication_de_deux_nombres&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;simplication_addition_avec_zero&#39;</span><span class="p">]</span> 
</pre></div>
</div>
<p>Ensuite, il faut réussir à appeler correctement et de façon recursive ces méthodes…</p>
<ol class="arabic simple" start="10">
<li><p>Pour l’affichage des opérateurs binaires, les règles de priorité peuvent être utilisées pour éviter de mettre trop de parenthèses. Par exemple, dans le cas <code class="docutils literal notranslate"><span class="pre">a*(b+c)</span></code>, la multiplication appelle le display de l’addition. Comme elle est prioritaire, l’addition va renvoyer le résulat avec des parenthèses. Dans le cas inverse <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b*c</span></code>, c’est inutile. Il faut donc que le display d’un opérateur passe sa priorité à ses enfants lors de l’appel de display. Implémenter ce principe.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">class</span> <span class="nc">Expr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Number</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Expr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">reversed_binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Number</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Expr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Sum</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Prod</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Div</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Sub</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversed_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Sum</span><span class="p">)</span>
 
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversed_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Prod</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversed_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Div</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversed_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Sub</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Neg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diff</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Leave</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="k">class</span> <span class="nc">Symbol</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbole</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symb</span> <span class="o">=</span> <span class="n">symbole</span>
        
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symb</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kwd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symb</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;La valeur de </span><span class="si">{}</span><span class="s2"> n&#39;est pas définie&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symb</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symb</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">symb</span>

    <span class="k">def</span> <span class="nf">_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">==</span><span class="n">var</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Number</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Leave</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbre</span> <span class="o">=</span> <span class="n">nombre</span>
        
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbre</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbre</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Number</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">nbre</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">nbre</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Number</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function with an arbitrary number of arguments &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="n">evaluated_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">**</span><span class="n">kwd</span><span class="p">)</span> <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">math_function</span><span class="p">(</span><span class="o">*</span><span class="n">evaluated_args</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">args</span>

    <span class="k">def</span> <span class="nf">_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="n">partial_derivative</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;partial_derivative&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">partial_derivative</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Cannot derivate function </span><span class="si">{self.__class__}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Number</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">*</span><span class="n">partial_derivative</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">deriv</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">partial_derivative</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">*</span><span class="n">deriv</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="n">liste_simplification</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">liste_simplification</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">elm</span><span class="p">)()</span>
            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tmp</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span>


<span class="k">class</span> <span class="nc">BinaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="n">commutative</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_priority</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parent_priority</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
            <span class="n">fmt_str</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">priority</span><span class="p">),</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">priority</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">commutative</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">args</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
    <span class="n">math_function</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span>
    <span class="n">commutative</span><span class="o">=</span><span class="kc">True</span>    
    <span class="n">partial_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">simplication_de_deux_nombres</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Number</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nbre</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nbre</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simplication_addition_avec_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">simplification_identique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">liste_simplification</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;simplication_de_deux_nombres&#39;</span><span class="p">,</span>
        <span class="s1">&#39;simplication_addition_avec_zero&#39;</span><span class="p">,</span> <span class="s1">&#39;simplification_identique&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Prod</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
    <span class="n">math_function</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span>
    <span class="n">commutative</span><span class="o">=</span><span class="kc">True</span>    
    <span class="n">partial_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simplication_de_deux_nombres</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Number</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nbre</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nbre</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">simplication_multiplication_par_un</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">simplication_multiplication_par_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Number</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="n">liste_simplification</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;simplication_de_deux_nombres&#39;</span><span class="p">,</span>
        <span class="s1">&#39;simplication_multiplication_par_un&#39;</span><span class="p">,</span> <span class="s1">&#39;simplication_multiplication_par_zero&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Div</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
    <span class="n">math_function</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">truediv</span>
    <span class="n">partial_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="o">-</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Sub</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">operator_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
    <span class="n">math_function</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span>
    <span class="n">partial_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UnitaryOperator</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>    
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_priority</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parent_priority</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
            <span class="n">fmt_str</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">{}{}</span><span class="s1">)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitary_symbol</span><span class="p">,</span> 
                              <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">priority</span><span class="p">))</span>
            
<span class="k">class</span> <span class="nc">Neg</span><span class="p">(</span><span class="n">UnitaryOperator</span><span class="p">):</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">unitary_symbol</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
    <span class="n">math_function</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">neg</span>
    <span class="n">partial_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span>
    
<span class="k">class</span> <span class="nc">MathFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">display</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">Sin</span><span class="p">(</span><span class="n">MathFunction</span><span class="p">):</span>     
    <span class="n">function_name</span> <span class="o">=</span> <span class="s1">&#39;sin&#39;</span>
    <span class="n">math_function</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span>
    <span class="n">partial_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),)</span>


<span class="k">class</span> <span class="nc">Cos</span><span class="p">(</span><span class="n">MathFunction</span><span class="p">):</span>     
    <span class="n">function_name</span> <span class="o">=</span> <span class="s1">&#39;cos&#39;</span>
    <span class="n">math_function</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span>
    <span class="n">partial_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),)</span>


<span class="n">sin</span> <span class="o">=</span> <span class="n">Sin</span>
<span class="n">cos</span> <span class="o">=</span> <span class="n">Cos</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2 * cos(2 * x)
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="feuilles_de_cours.html">Feuilles de cours</a></li>
<li class="toctree-l1"><a class="reference internal" href="feuilles_d_exercices.html">Feuilles d’exercices</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="correction.html">Correction</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cours1_fonctions_corr_exercices.html">Exercices sur les fonctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cours2_nombres_corr_exercices.html">Exercices sur les nombres</a></li>
<li class="toctree-l2"><a class="reference internal" href="cours3_conteneur_corr_exercices.html">Exercices sur les conteneurs</a></li>
<li class="toctree-l2"><a class="reference internal" href="cours4_chaine_caractere_corr_exercices.html">Chaînes de caractères</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Objets</a></li>
<li class="toctree-l2"><a class="reference internal" href="cours5_numpy_corr_exercices.html">Utilisation de numpy</a></li>
</ul>
</li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </div>

        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="cours4_chaine_caractere_corr_exercices.html" title="Chaînes de caractères"
              >previous</a> |
            <a href="cours5_numpy_corr_exercices.html" title="Utilisation de numpy"
              >next</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/cours6_objet_corr_exercices.ipynb.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, Pierre Cladé.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>